#!/bin/sh
# HotSpot add-on module to webif^2 v1.0
# by Liran Tal <liran@enginx.com>
#
# this module is part of the webif^2 interface for the x-wrt.
# thanks to thepeople and nbd for their help to understand the webif

. /etc/functions.sh

config_cb() {
	local cfgtype="$1"
	local name="$2"
	[ "$cfgtype" = "chilli" ] && chilli_cfg="$name" || unset chilli_cfg
}

option_cb() {
	local varname="$1"; shift
	local value="$*"
	[ -n "$chilli_cfg" ] && [ -n "$value" ] && [ "$value" != "0" ] && {
		if [ "$value" = "1" ]; then
			chilli_options="$chilli_options${varname}${_lf}"
		else
			chilli_options="$chilli_options${varname} ${value}${_lf}"
		fi
	}
}

_lf="
"
chilli_config="/etc/chilli.conf"
chilli_options="# this file is automatically generated${_lf}"
config_load hotspot
echo "$chilli_options" > "$chilli_config"
