#!/bin/sh
. /usr/lib/webif/webif.sh
# HotSpot add-on module to webif^2 v1.0
# by Liran Tal <liran@enginx.com>
#
# this module is part of the webif^2 interface for the x-wrt.
# thanks to thepeople and nbd for their help to understand the webif

is_kamikaze && {
	uci_load "hotspot"
	set | sed '/^CONFIG_chilli_/!d; /^CONFIG_chilli_TYPE/d; s/^CONFIG_chilli_//; s/='\''/=/; s/'\''$//;' | awk -F '=' '
	BEGIN {
		print "# this file is automatically generated"
	}
	{
		print $1 " " $2
	}' > /etc/chilli.conf
} || {
	nvram show 2>/dev/null | sed '/^chilli_/!d; s/^chilli_//;' | awk -F '=' '
	sub(/debug.1/, "debug")
	sub(/debug.0/, "")
	sub(/macauth.1/, "macauth")
	sub(/macauth.0/, "")
	sub(/uamanydns.1/, "uamanydns")
	sub(/uamanydns.0/, "")
	BEGIN {
		print "# this file is automatically generated"
	}
	{
		print $1 " " $2
	}' > /etc/chilli.conf
}
